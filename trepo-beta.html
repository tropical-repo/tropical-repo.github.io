<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>TropicalRepo: 7 Beta Diversity &amp; Dispersion Estimates</title>

  <meta property="description" itemprop="description" content="Reproducible workflow for ... In this workflow, ...."/>

  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
  <link rel="icon" type="image/vnd.microsoft.icon" href="assets/favicon.ico"/>


  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="TropicalRepo: 7 Beta Diversity &amp; Dispersion Estimates"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Reproducible workflow for ... In this workflow, ...."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="TropicalRepo"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="TropicalRepo: 7 Beta Diversity &amp; Dispersion Estimates"/>
  <meta property="twitter:description" content="Reproducible workflow for ... In this workflow, ...."/>

  <!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","bibliography","output"]}},"value":[{"type":"character","attributes":{},"value":["7 Beta Diversity & Dispersion Estimates"]},{"type":"character","attributes":{},"value":["Reproducible workflow for ... In this workflow, ....\n"]},{"type":"character","attributes":{},"value":["assets/cite.bib"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["css","toc","toc_depth"]}},"value":[{"type":"character","attributes":{},"value":["assets/styles.css"]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <style type="text/css">
  /* Whole document: */
  @import url('https://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|Lato:300|Roboto:300|Nunito+Sans:300|Inconsolata|Source+Sans+Pro|Work+Sans:200,300,400,500');
  /********************************/
  /* controls general properties of site*/
  /********************************/

  body {
    color: #414141;
  /*  line-height: 1.7;
    font-size: 17px; */
    background-color: #FEFEFE;
  }

  d-title h1{
  font-size: 2.1em;
  font-family: 'Work Sans';
  font-weight: 300;
  }

  d-article h1 {
    font-size: 1.8em;
    font-family: 'Work Sans', 'Source Sans Pro', 'PT Sans';
    font-weight: 300;
  }

  d-article h2 {
    font-size: 1.65em;
    font-family: 'Work Sans', 'Source Sans Pro', 'PT Sans';
    font-weight: 500;
  }

  d-article h3 {
    margin-top: 1em;
  }

  d-byline .authors-affiliations {
    grid-column-end: span 3;
    grid-column-gap: 8px;
  }

  img.orcid-id {
    margin: 0;
  }

  a.name:-webkit-any-link {
    text-decoration: underline;
    text-decoration-style: dotted;
  }

  a.affiliation:-webkit-any-link {
    text-decoration: underline;
    text-decoration-style: dotted;
  }

  blockquote p {
  	font-size: 1.3em;
  	font-family: 'Lato';
    font-style: normal;
    margin: 0.5em 0 0.5em;
  }

  d-article li {
    margin: 0px 0px 4px;
  }

  /********************************/
  /* controls CODE*/
  /********************************/

  /** pre.sourceCode controls code block without lang **/

  /** Controls r code  **/

  pre.sourceCode.r {
    margin-top: 0px;
     color: #333333;
     background-color: #E8E8E8;
     border-radius: 3px;
     font-size: 0.80em;
     font-family: 'Monaco', 'PT Mono', monospace;
     overflow-x: scroll !important;
     border-left: 6px solid #323232;
     border-top: 1px solid #B7B7B7;
     border-right: 1px solid #B7B7B7;
     border-bottom: 1px solid #B7B7B7;
     padding: 18px 0px 18px 20px;
   }

   pre.sourceCode.bash {
     margin-top: 0px;
      color: #333333;
      background-color: #E8E8E8;
      border-radius: 3px;
      font-size: 0.80em;
      font-family: 'Monaco', 'PT Mono', monospace;
      overflow-x: scroll !important;
      border-left: 6px solid #FC6464;
      border-top: 1px solid #B7B7B7;
      border-right: 1px solid #B7B7B7;
      border-bottom: 1px solid #B7B7B7;
      padding: 18px 0px 18px 20px;
    }
  /** Controls code output **/

  d-article pre {
     margin-top: 0px;
      color: #333333;
      background-color: #FAFAFA;
      font-size: 0.8em;
      border: 1px solid #ccc;
      overflow-x: scroll !important;
      padding:  10px 10px 10px 18px;
      border-radius: 5px;

    }

  /** Controls inline code  **/

  p code {
    background-color: #E8E8E8;
    border-radius: 3px;
    font-size: 0.8em;
    font-family: 'Monaco', 'PT Mono', monospace;
    overflow-x: scroll !important;
    margin-bottom: 20px;
    color: #BF2727;
  }

  d-article aside code {
    background-color: #E8E8E8;
    border-radius: 3px;
    font-family: 'Monaco', 'PT Mono', monospace;
    color: #BF2727;
  }

  /********************************/
  /* controls NAV BAR and HEADERS*/
  /********************************/

  .nav-dropdown-content .nav-dropdown-header {
    text-transform: none;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header  {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .headroom {
      z-index: 1000;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
  }
  .distill-site-nav {
      background-color: #00203F;
      font-size: 15px;
      font-weight: 300;
  }

  img {
    margin: 5px;
  }

  /** LIGHTBOX MARKUP **/
  .thumbnail {
    max-width: 100%;
    position: relative;
  }

  /** DETAILS fold down**/

  details {
    background-color: hsla(206, 95%, 20%, 0.2);
    cursor: pointer;
    color: #2d2d2d;
    margin-bottom:1vh;
    padding: 1em;
    border: none;
    text-align: left;
    outline: none;
  }

  .active, details:hover {
    transition: max-height 0.2s ease-out;
    outline: none;

    /* background-color: #acc2c2; */
  }


  details {
    display: flex;
    justify-content: space-between;
    align-content: center;
    border-radius: 4px;
    outline: none;
  }

  details.active {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    outline: none;
  }

  summary::-webkit-details-marker {
    display: none;
    outline: none;
  }

  summary:focus {
    outline: none;
  }

  summary::after {
    float: right;
    font-family: "Font Awesome 5 Free";
    content: "\f0fe";
  }

  details[open] summary::after {
    float: right;
    font-family: "Font Awesome 5 Free";
    content: "\f146";
  }


  /********************************/
  /* dygraph*/
  /********************************/

  </style>
  <!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="assets/styles.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"7 Beta Diversity & Dispersion Estimates","description":"Reproducible workflow for ... In this workflow, ....","authors":[]}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="index.html">
<img src="assets/icon.png" alt="Logo"/>
</a>
<a href="index.html" class="title">TropicalRepo</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="trepo-summary.html">Summary</a>
<a href="trepo-physical.html">Physical</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Macrofauna
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<hr/>
<a href="trepo-macrotaxa.html">4. Macrofauna Taxa</a>
<a href="trepo-temporal.html">3. Temporal Diversity</a>
<a href="trepo-macrobeta.html">2. Beta Diversity</a>
<a href="trepo-macroalpha.html">1. Alpha Diversity</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Microbial
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<span class="nav-dropdown-header">Diversity Workflows</span>
<hr/>
<a href="trepo-metadata.html">9. Metadata</a>
<a href="trepo-da.html">8. DA ASVs &amp; OTUs</a>
<a href="trepo-beta.html">7. Beta Diversity</a>
<a href="trepo-alpha.html">6. Alpha Diversity</a>
<a href="trepo-taxa.html">5. Taxonomic</a>
<hr/>
<span class="nav-dropdown-header">Processing Workflows</span>
<a href="trepo-pime.html">4. PIME</a>
<a href="trepo-otu.html">3. OTU Clustering</a>
<a href="trepo-data-prep.html">2. Data Set Prep</a>
<a href="trepo-dada2.html">1. DADA2</a>
<hr/>
</div>
</div>
<a href="trepo-data.html">Data</a>
<a href="https://github.com/tropical-repo/web/" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>7 Beta Diversity &amp; Dispersion Estimates</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Reproducible workflow for … In this workflow, ….</p></p>
</div>


<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#synopsis">Synopsis</a></li>
<li><a href="#full-data-set">Full Data Set</a>
<ul>
<li><a href="#significance-tests">Significance Tests</a>
<ul>
<li><a href="#beta-dispersion">Beta Dispersion</a></li>
<li><a href="#significance-tests-all-asvs">Significance Tests (ALL ASVs)</a></li>
<li><a href="#significance-tests-pime-asvs">Significance Tests (PIME ASVs)</a></li>
<li><a href="#summary">Summary</a></li>
</ul></li>
<li><a href="#beta-diversity-plots">Beta Diversity Plots</a>
<ul>
<li><a href="#plots-all-asvs">Plots ALL ASVs</a></li>
<li><a href="#plots-all-pime-asv">Plots ALL PIME ASV</a></li>
</ul></li>
<li><a href="#beta-diversity-plots-by-site">Beta Diversity Plots (by Site)</a>
<ul>
<li><a href="#plots-all-asvs-1">Plots ALL ASVs</a></li>
<li><a href="#plots-pime-asvs">Plots PIME ASVs</a></li>
</ul></li>
</ul></li>
<li><a href="#merged-data-set">Merged Data Set</a>
<ul>
<li><a href="#significance-tests-1">Significance Tests</a>
<ul>
<li><a href="#beta-dispersion-1">Beta Dispersion</a></li>
<li><a href="#significance-tests-all-asvs-1">Significance Tests (ALL ASVs)</a></li>
<li><a href="#significance-tests-pime-asvs-1">Significance Tests (PIME ASVs)</a></li>
<li><a href="#summary-1">Summary</a></li>
</ul></li>
<li><a href="#beta-diversity-plots-1">Beta Diversity Plots</a>
<ul>
<li><a href="#plots-all-asvs-2">Plots ALL ASVs</a></li>
<li><a href="#plots-all-pime-asv-1">Plots ALL PIME ASV</a></li>
</ul></li>
<li><a href="#beta-diversity-plots-by-site-1">Beta Diversity Plots (by Site)</a>
<ul>
<li><a href="#plots-all-asvs-3">Plots ALL ASVs</a></li>
<li><a href="#plots-pime-asvs-1">Plots PIME ASVs</a></li>
</ul></li>
<li><a href="#source-code">Source Code</a></li>
</ul></li>
</ul>
</nav>
</div>
<blockquote>
<p>Hit the <em>Hide Code</em> button to hide the R code.</p>
</blockquote>
<aside>
<div class="layout-chunk" data-layout="l-body">
<input onclick="codefolder(&#39;pre.sourceCode&#39;);" type="button" value="Hide Code" id="codefolder-button" style="position: absolute; right: 14%; z-index: 200"/>
<script>
  function codefolder(query) {

    var x = document.querySelectorAll(query);
    if (x.length === 0) return;

    function toggle_vis(o) {
      var d = o.style.display;
      o.style.display = (d === 'block' || d === '') ? 'none':'block';
    }

    for (i = 0; i < x.length; i++) {
      var y = x[i];
      toggle_vis(y);
    }

    var elem = document.getElementById("codefolder-button");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
  }
</script>
</div>
</aside>
<h1 id="synopsis">Synopsis</h1>
<p>This workflow contains beta diversity assessments. In order to run the workflow, you either need to first run the <a href="trepo-dada2.html">DADA2 Workflow</a> <strong>and</strong> the <a href="trepo-data-prep.html">Data Preparation workflow</a> <strong>or</strong> begin with the output files from the Data Preparation workflow. See the <a href="data-availability.html">Data Availability</a> page for complete details.</p>
<p>In this workflow…</p>
<h1 id="full-data-set">Full Data Set</h1>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="significance-tests">Significance Tests</h2>
<p>In order to test for significance between sample groups, we must perform the following steps:</p>
<ol type="1">
<li>Create distance matrices based on the metrics above (<code>wunifrac</code>, <code>unifrac</code>, <code>jsd</code>). For this we use the function <code>phyloseq::distance</code>.</li>
<li>Next, calculate beta dispersion using the <code>betadisper</code> function from the <code>vegan</code> package.</li>
<li>Then, use the function <code>permutest</code> to run a Permutation test for homogeneity of multivariate dispersions.</li>
<li>If the beta dispersion tests are not significant we will run a PERMANOVA (since PERMANOVA assumes equal dispersion), otherwise we will use Analysis of Similarity (ANOSIM).</li>
</ol>
<p>Steps 1, 2, and 3 are analyzed in a <code>for</code> loop that tests all three distance metrics.</p>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work&quot;</span>, <span class="st">&quot;ssu_ps_pime&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) <span class="fl">1E6</span> <span class="sc">*</span> otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h3 id="beta-dispersion">Beta Dispersion</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;jsd&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;wunifrac&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>             tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>             tmp_samp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>             tmp_df <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(tmp_get, <span class="at">method =</span> d)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>             tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_beta_dist_&quot;</span>, .))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name, tmp_df)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>             tmp_df2 <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(tmp_df, tmp_samp<span class="sc">$</span>SITE, <span class="at">bias.adjust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>             tmp_df_name2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_beta_dispersion_&quot;</span>, .))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name2, tmp_df2)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             tmp_df3 <span class="ot">&lt;-</span> <span class="fu">permutest</span>(tmp_df2, <span class="at">pairwise =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">binary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>             tmp_df_name3 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_permutest_&quot;</span>, .))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name3, tmp_df3)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Beta Dispersion &amp; Permutation tests
</summary>
<h5 id="permutation-tests-asv">Permutation tests (ASV)</h5>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
            ***** ssu_ps_work ***** 

#################################################### 
BETA DISPERSION significance test jsd distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df  Sum Sq  Mean Sq     F N.Perm   Pr(&gt;F)    
Groups      3 0.06601 0.022003 10.02   1000 0.000999 ***
Residuals 300 0.65879 0.002196                          
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
             ALMR         CRIS         PAST   PUCL
ALMR              0.0009990010 0.0009990010 0.0010
CRIS 0.0000040144              0.4655344655 0.5145
PAST 0.0003331539 0.4580143926              0.2068
PUCL 0.0000031398 0.5088286342 0.2029848564       

#################################################### 
BETA DISPERSION significance test unifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df  Sum Sq   Mean Sq      F N.Perm  Pr(&gt;F)  
Groups      3 0.03211 0.0107023 4.1671   1000 0.01099 *
Residuals 300 0.77049 0.0025683                        
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
           ALMR       CRIS       PAST   PUCL
ALMR            0.00099900 0.02197802 0.0440
CRIS 0.00069814            0.25574426 0.2158
PAST 0.01829183 0.28214168            0.8601
PUCL 0.04063699 0.23952345 0.85615514       

#################################################### 
BETA DISPERSION significance test wunifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq   Mean Sq      F N.Perm   Pr(&gt;F)   
Groups      3 0.011834 0.0039447 4.3124   1000 0.005994 **
Residuals 300 0.274416 0.0009147                          
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
          ALMR      CRIS      PAST   PUCL
ALMR           0.0019980 0.0059940 0.0020
CRIS 0.0016073           0.8711289 0.8891
PAST 0.0049908 0.8836520           0.7862
PUCL 0.0029881 0.8854266 0.7879608       

            ***** ssu_ps_pime ***** 

#################################################### 
BETA DISPERSION significance test jsd distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq   Mean Sq      F N.Perm   Pr(&gt;F)    
Groups      3 0.036789 0.0122629 29.194   1000 0.000999 ***
Residuals 300 0.126016 0.0004201                           
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
                         ALMR                     CRIS
ALMR                          0.0589410589410589436099
CRIS 0.0492723537862556834610                         
PAST 0.0001881309224778698105 0.0161078666106647255818
PUCL 0.0000000000000000021297 0.0000000000000057418658
                         PAST  PUCL
ALMR 0.0009990009990009990001 0.001
CRIS 0.0159840159840159840021 0.001
PAST                          0.001
PUCL 0.0001432830151268239100      

#################################################### 
BETA DISPERSION significance test unifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq    Mean Sq      F N.Perm   Pr(&gt;F)    
Groups      3 0.008628 0.00287585 6.9188   1000 0.000999 ***
Residuals 300 0.124697 0.00041566                           
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
             ALMR         CRIS         PAST   PUCL
ALMR              0.0329670330 0.0049950050 0.0010
CRIS 0.0295554789              0.4445554446 0.0130
PAST 0.0057829642 0.4685734650              0.1229
PUCL 0.0000028596 0.0146358858 0.1153458947       

#################################################### 
BETA DISPERSION significance test wunifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq    Mean Sq      F N.Perm   Pr(&gt;F)   
Groups      3 0.002575 0.00085833 4.0231   1000 0.008991 **
Residuals 300 0.064005 0.00021335                          
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
          ALMR      CRIS      PAST   PUCL
ALMR           0.5264735 0.0089910 0.0170
CRIS 0.5336665           0.0209790 0.0699
PAST 0.0065328 0.0257913           0.4126
PUCL 0.0138408 0.0661387 0.4159449       </code></pre>
</div>
</details>
<p>Remember, if the beta dispersion p-value is greater than <code>0.05</code> we use PERMANOVA, otherwise we use ANOSIM.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">&quot;files/trepo/beta/tables/tmp.txt&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_permutest_&quot;</span>, d)))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>          tmp_res <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">isTRUE</span>(tmp_get<span class="sc">$</span>tab<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>          tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Permutation test p-value of  &quot;</span>, i, d,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot; &lt; 0.05?&quot;</span>, tmp_res)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(tmp_print,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">append =</span> <span class="cn">TRUE</span>, <span class="at">file =</span> <span class="st">&quot;files/trepo/beta/tables/tmp.txt&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>ssu_perm_pvalues <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;files/trepo/beta/tables/tmp.txt&quot;</span>,  </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">col_names =</span> <span class="st">&quot;permutation results&quot;</span>)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 id="significance-tests-all-asvs">Significance Tests (ALL ASVs)</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code># A tibble: 3 x 1
  `permutation results`                                              
  &lt;chr&gt;                                                              
1 &quot;Permutation test p-value of   ssu_ps_work jsd  &lt; 0.05? TRUE &quot;     
2 &quot;Permutation test p-value of   ssu_ps_work unifrac  &lt; 0.05? TRUE &quot; 
3 &quot;Permutation test p-value of   ssu_ps_work wunifrac  &lt; 0.05? TRUE &quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_anosim_jsd <span class="ot">&lt;-</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_work_prop, <span class="st">&quot;jsd&quot;</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_work_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_anosim_unifrac <span class="ot">&lt;-</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_work_prop, <span class="st">&quot;unifrac&quot;</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_work_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_anosim_wunifrac <span class="ot">&lt;-</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_work_prop, <span class="st">&quot;wunifrac&quot;</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_work_groups)</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Significance tests for the ALL ASV data set
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
 ***ANOSIM for Jensen-Shannon Divergence, `jsd`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_work_prop, &quot;jsd&quot;), grouping = ssu_ps_work_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8165 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00693 0.01054 0.01422 0.01879 

Dissimilarity ranks between and within classes:
        0%     25%     50%      75%  100%     N
Between 34 19411.5 28728.5 37392.25 46056 34656
ALMR     3  1266.5  3664.5  7671.75 22876  2850
CRIS    33  6132.5  9734.5 13611.75 26480  2850
PAST     1  3913.5  8208.0 13723.50 26994  2850
PUCL     6  6351.5 11386.0 15690.75 25006  2850</code></pre>
<pre><code>
 ***ANOSIM for Unweighted UniFrac distance, `unifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_work_prop, &quot;unifrac&quot;), grouping = ssu_ps_work_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.7113 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00693 0.00981 0.01266 0.01597 

Dissimilarity ranks between and within classes:
        0%      25%     50%      75%  100%     N
Between 27 18308.75 28274.5 37235.25 46056 34656
ALMR    14  1697.25  6373.5 12299.75 45570  2850
CRIS    60  7200.00 11348.0 16306.00 45905  2850
PAST     1  4608.75  9468.5 14801.75 46023  2850
PUCL     2  3960.75  9532.5 16264.75 45641  2850</code></pre>
<pre><code>
 ***ANOSIM for Weighted-UniFrac distance, `wunifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_work_prop, &quot;wunifrac&quot;),      grouping = ssu_ps_work_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8238 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00869 0.01175 0.01520 0.02001 

Dissimilarity ranks between and within classes:
         0%      25%     50%      75%  100%     N
Between 195 19191.50 28722.5 37392.25 46056 34656
ALMR      4  1640.25  4403.0  8986.25 24992  2850
CRIS     21  4949.00  8793.0 13249.50 30120  2850
PAST      1  3730.25  8439.0 14273.50 30286  2850
PUCL      3  4515.75  9375.5 14566.50 29327  2850</code></pre>
</div>
</details>
<h3 id="significance-tests-pime-asvs">Significance Tests (PIME ASVs)</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code># A tibble: 3 x 1
  `permutation results`                                              
  &lt;chr&gt;                                                              
1 &quot;Permutation test p-value of   ssu_ps_pime jsd  &lt; 0.05? TRUE &quot;     
2 &quot;Permutation test p-value of   ssu_ps_pime unifrac  &lt; 0.05? TRUE &quot; 
3 &quot;Permutation test p-value of   ssu_ps_pime wunifrac  &lt; 0.05? TRUE &quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_anosim_jsd <span class="ot">&lt;-</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_pime_prop, <span class="st">&quot;jsd&quot;</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_pime_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_anosim_unifrac <span class="ot">&lt;-</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_pime_prop, <span class="st">&quot;unifrac&quot;</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_pime_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_anosim_wunifrac <span class="ot">&lt;-</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_pime_prop, <span class="st">&quot;wunifrac&quot;</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_pime_groups)</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Significance tests for PIME data set
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
 ***ANOSIM for Jensen-Shannon Divergence, `jsd`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_pime_prop, &quot;jsd&quot;), grouping = ssu_ps_pime_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8905 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00788 0.01097 0.01526 0.01977 

Dissimilarity ranks between and within classes:
          0%      25%     50%      75%  100%     N
Between  679 19874.75 28728.5 37392.25 46056 34656
ALMR       1  1009.50  2746.0  6068.00 22760  2850
CRIS     163  3136.75  4835.5  7411.75 21666  2850
PAST       7  2738.25  5902.5 13069.00 26533  2850
PUCL    2905 10087.50 12235.5 14355.75 21756  2850</code></pre>
<pre><code>
 ***ANOSIM for Unweighted UniFrac distance, `unifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_pime_prop, &quot;unifrac&quot;), grouping = ssu_ps_pime_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8999 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00819 0.01134 0.01627 0.02187 

Dissimilarity ranks between and within classes:
          0%      25%     50%      75%  100%     N
Between 1025 19680.75 28728.5 37392.25 46056 34656
ALMR       1  1474.50  3703.5  7350.25 21728  2850
CRIS      43  3062.50  5850.5 10042.00 22127  2850
PAST       3  2521.50  6287.5 12541.50 27034  2850
PUCL     417  5948.25  9031.5 12674.75 23433  2850</code></pre>
<pre><code>
 ***ANOSIM for Weighted-UniFrac distance, `wunifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_pime_prop, &quot;wunifrac&quot;),      grouping = ssu_ps_pime_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8928 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
    90%     95%   97.5%     99% 
0.00757 0.01112 0.01482 0.02063 

Dissimilarity ranks between and within classes:
         0%      25%     50%      75%  100%     N
Between 204 19617.75 28724.5 37392.25 46056 34656
ALMR      1  1575.50  4401.5  9121.50 25690  2850
CRIS     11  2710.75  5299.5  9662.75 25182  2850
PAST      3  3311.25  7608.0 14107.00 33336  2850
PUCL    244  5101.75  8088.5 11271.25 23137  2850</code></pre>
</div>
</details>
<h3 id="summary">Summary</h3>
<p>Here is a quick summary of significance tests for the FULL and PIME ASV data sets against the three distance matrices.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">distance metric</th>
<th style="text-align: right;">p-value (ALL)</th>
<th style="text-align: right;">p-value (PIME)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Jensen-Shannon Divergence</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;">unweighted UniFrac</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weighted UniFrac</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">0.001</td>
</tr>
</tbody>
</table>
</div>
<p><em>Summary of significant tests for the ALL ASVs and PIME ASVs data sets.</em></p>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="beta-diversity-plots">Beta Diversity Plots</h2>
<div class="layout-chunk" data-layout="l-body">

</div>
<details>
<summary>
This is code in progress. No peaking
</summary>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;hack_code/phyloseq_to_ampvis2.R&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>tmp_otu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">otu_table</span>(ssu_ps_work)))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>tmp_otu[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tmp_otu, as.numeric)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>tmp_otu <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(tmp_otu)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">data.frame</span>(<span class="fu">tax_table</span>(ssu_ps_work)))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>tmp_samp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(ssu_ps_work))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ssu_ps_amp <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(<span class="fu">otu_table</span>(tmp_otu, <span class="at">taxa_are_rows =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tax_table</span>(tmp_tax, tmp_tax),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">sample_data</span>(tmp_samp))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>tmp_amp_asv_pime  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">otu_table</span>(ssu_ps_amp))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>tmp_amp_asv_pime <span class="ot">&lt;-</span> tmp_amp_asv_pime <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;OTU&quot;</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>tmp_amp_tax_pime  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(ssu_ps_amp))</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>tmp_amp_tax_pime <span class="ot">&lt;-</span> tmp_amp_tax_pime <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;OTU&quot;</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>tmp_amp_tax_pime<span class="sc">$</span>ASV_SEQ <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp_amp_tax_pime)[<span class="fu">colnames</span>(tmp_amp_tax_pime) <span class="sc">==</span> <span class="st">&quot;ASV_ID&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Species&quot;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>tmp_amp_asv_tax_pime <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tmp_amp_asv_pime, tmp_amp_tax_pime, <span class="at">by =</span> <span class="st">&quot;OTU&quot;</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>tmp_samp_data_t <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(ssu_ps_amp))</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>ssu_amp_work <span class="ot">&lt;-</span> <span class="fu">amp_load</span>(tmp_amp_asv_tax_pime, <span class="at">metadata =</span> tmp_samp_data_t, <span class="at">tree =</span> <span class="fu">phy_tree</span>(ssu_ps_work))</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tmp_select <span class="ot">&lt;-</span> ssu_amp_work</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>tmp_select<span class="sc">$</span>metadata<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_select<span class="sc">$</span>metadata<span class="sc">$</span>SITE, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ssu_amp_work <span class="ot">&lt;-</span> tmp_select</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>swel_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#CC79A7&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">amp_ordinate</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  ssu_amp_work,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">filter_species =</span> <span class="fl">0.1</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;PCoA&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">distmeasure =</span> <span class="st">&quot;wunifrac&quot;</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">constrain =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_axis =</span> <span class="dv">1</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_axis =</span> <span class="dv">2</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">print_caption =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_by =</span> <span class="st">&quot;SITE&quot;</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_color_order =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_shape_by =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_colorframe_label_size =</span> <span class="dv">3</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_label_by =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_label_size =</span> <span class="dv">4</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_label_segment_color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_point_size =</span> <span class="dv">2</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_trajectory =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_trajectory_group =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_plotly =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_nlabels =</span> <span class="dv">0</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_label_taxonomy =</span> <span class="st">&quot;Genus&quot;</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_label_size =</span> <span class="dv">3</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_label_color =</span> <span class="st">&quot;grey10&quot;</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_rescale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_point_size =</span> <span class="dv">2</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_shape =</span> <span class="dv">20</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_plotly =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_factor =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_numeric =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_signif_level =</span> <span class="fl">0.005</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_textsize =</span> <span class="dv">3</span>,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_textcolor =</span> <span class="st">&quot;darkred&quot;</span>,</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_numeric_arrows_scale =</span> <span class="dv">1</span>,</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_arrowcolor =</span> <span class="st">&quot;darkred&quot;</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">envfit_show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">repel_labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">opacity =</span> <span class="fl">0.8</span>,</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">tax_empty =</span> <span class="st">&quot;best&quot;</span>,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">detailed_output =</span> <span class="cn">FALSE</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col) </span></code></pre></div>
</div>
</details>
<p>Here we visualize the different distance matrices using several ordination methods on the ALL and PIME filtered data sets to access dissimilarity among sample.</p>
<h3 id="plots-all-asvs">Plots ALL ASVs</h3>
<p>First, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements. We could also test different diversity metrics, different transformations, etc.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_work&quot;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SITE, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SITE))</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_work&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-31"></span>
<img src="include/trepo/beta/ssu_ps_work_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 1: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h3 id="plots-all-pime-asv">Plots ALL PIME ASV</h3>
<p>Same as above, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_pime&quot;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SITE, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SITE))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_pime&quot;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-37"></span>
<img src="include/trepo/beta/ssu_ps_pime_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 2: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="beta-diversity-plots-by-site">Beta Diversity Plots (by Site)</h2>
<p>Here we visualize the different distance matrices using several ordination methods on the ALL and PIME filtered data sets to access dissimilarity among samples from <strong>the same site</strong>.</p>
<h3 id="plots-all-asvs-1">Plots ALL ASVs</h3>
<p>First, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements. We could also test different diversity metrics, different transformations, etc.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_ALMR <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_ALMR.rds&quot;</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_CRIS  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_CRIS.rds&quot;</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_PAST <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_PAST.rds&quot;</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_PUCL <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_PUCL.rds&quot;</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_work_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_work_PAST&quot;</span>, <span class="st">&quot;ssu_ps_work_PUCL&quot;</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_work_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_work_PAST&quot;</span>, <span class="st">&quot;ssu_ps_work_PUCL&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps){</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SEASON&quot;</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SEASON, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SEASON))</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h4 id="almirante-inner-bay">Almirante (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-47"></span>
<img src="include/trepo/beta/ssu_ps_work_ALMR_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 3: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="pastores-inner-bay">Pastores (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-51"></span>
<img src="include/trepo/beta/ssu_ps_work_PAST_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 4: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="cristobal-outer-bay">Cristobal (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-55"></span>
<img src="include/trepo/beta/ssu_ps_work_CRIS_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 5: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="punta-caracol-outer-bay">Punta Caracol (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-59"></span>
<img src="include/trepo/beta/ssu_ps_work_PUCL_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 6: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h3 id="plots-pime-asvs">Plots PIME ASVs</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_ALMR <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_asv_pime_ALMR.rds&quot;</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_CRIS  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_asv_pime_CRIS.rds&quot;</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_PAST <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_asv_pime_PAST.rds&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_PUCL <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_asv_pime_PUCL.rds&quot;</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_pime_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_pime_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_pime_PAST&quot;</span>, <span class="st">&quot;ssu_ps_pime_PUCL&quot;</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_pime_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_pime_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_pime_PAST&quot;</span>, <span class="st">&quot;ssu_ps_pime_PUCL&quot;</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps){</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SEASON&quot;</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SEASON, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SEASON))</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h4 id="almirante-inner-bay-1">Almirante (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-68"></span>
<img src="include/trepo/beta/ssu_ps_pime_ALMR_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 7: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="pastores-inner-bay-1">Pastores (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-72"></span>
<img src="include/trepo/beta/ssu_ps_pime_PAST_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 8: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="cristobal-outer-bay-1">Cristobal (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-76"></span>
<img src="include/trepo/beta/ssu_ps_pime_CRIS_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 9: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="punta-caracol-outer-bay-1">Punta Caracol (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-80"></span>
<img src="include/trepo/beta/ssu_ps_pime_PUCL_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 10: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h1 id="merged-data-set">Merged Data Set</h1>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="significance-tests-1">Significance Tests</h2>
<p>In order to test for significance between sample groups, we must perform the following steps:</p>
<ol type="1">
<li>Create distance matrices based on the metrics above (<code>wunifrac</code>, <code>unifrac</code>, <code>jsd</code>). For this we use the function <code>phyloseq::distance</code>.</li>
<li>Next, calculate beta dispersion using the <code>betadisper</code> function from the <code>vegan</code> package.</li>
<li>Then, use the function <code>permutest</code> to run a Permutation test for homogeneity of multivariate dispersions.</li>
<li>If the beta dispersion tests are not significant we will run a PERMANOVA (since PERMANOVA assumes equal dispersion), otherwise we will use Analysis of Similarity (ANOSIM).</li>
</ol>
<p>Steps 1, 2, and 3 are analyzed in a <code>for</code> loop that tests all three distance metrics.</p>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work&quot;</span>, <span class="st">&quot;ssu_ps_pime&quot;</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h3 id="beta-dispersion-1">Beta Dispersion</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;jsd&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;wunifrac&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>             tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>             tmp_samp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(tmp_get))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>             tmp_df <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(tmp_get, <span class="at">method =</span> d)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>             tmp_df_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_beta_dist_&quot;</span>, .))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name, tmp_df)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>             tmp_df2 <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(tmp_df, tmp_samp<span class="sc">$</span>SITE, <span class="at">bias.adjust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>             tmp_df_name2 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_beta_dispersion_&quot;</span>, .))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name2, tmp_df2)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>             tmp_df3 <span class="ot">&lt;-</span> <span class="fu">permutest</span>(tmp_df2, <span class="at">pairwise =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">binary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>             tmp_df_name3 <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_permutest_&quot;</span>, .))</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">assign</span>(tmp_df_name3, tmp_df3)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>       }</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Beta Dispersion &amp; Permutation tests
</summary>
<h5 id="permutation-tests-asv-1">Permutation tests (ASV)</h5>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
            ***** ssu_ps_work ***** 

#################################################### 
BETA DISPERSION significance test jsd distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq   Mean Sq      F N.Perm  Pr(&gt;F)  
Groups      3 0.010976 0.0036585 3.4265   1000 0.02098 *
Residuals 100 0.106771 0.0010677                        
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
          ALMR      CRIS      PAST   PUCL
ALMR           0.0039960 0.0089910 0.0140
CRIS 0.0032878           0.7422577 0.9391
PAST 0.0133486 0.7425251           0.8192
PUCL 0.0117791 0.9393926 0.8168891       

#################################################### 
BETA DISPERSION significance test unifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq   Mean Sq      F N.Perm Pr(&gt;F)
Groups      3 0.010562 0.0035206 1.8701   1000 0.1469
Residuals 100 0.188259 0.0018826                     

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
         ALMR     CRIS     PAST   PUCL
ALMR          0.055944 0.089910 0.4126
CRIS 0.046394          0.804196 0.1888
PAST 0.087320 0.824809          0.2987
PUCL 0.427589 0.192537 0.309912       

#################################################### 
BETA DISPERSION significance test wunifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq    Mean Sq      F N.Perm Pr(&gt;F)
Groups      3 0.002711 0.00090379 1.8126   1000 0.1499
Residuals 100 0.049861 0.00049861                     

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
         ALMR     CRIS     PAST   PUCL
ALMR          0.168831 0.058941 0.1908
CRIS 0.158753          0.259740 0.8671
PAST 0.046665 0.270591          0.3936
PUCL 0.176810 0.874601 0.370417       

            ***** ssu_ps_pime ***** 

#################################################### 
BETA DISPERSION significance test jsd distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq    Mean Sq      F N.Perm   Pr(&gt;F)   
Groups      3 0.005337 0.00177907 4.6404   1000 0.004995 **
Residuals 100 0.038339 0.00038339                          
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
           ALMR       CRIS       PAST   PUCL
ALMR            0.14285714 0.00499500 0.0010
CRIS 0.13505721            0.07692308 0.0200
PAST 0.00966154 0.06683560            0.6953
PUCL 0.00077929 0.01979019 0.68542506       

#################################################### 
BETA DISPERSION significance test unifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df   Sum Sq    Mean Sq      F N.Perm Pr(&gt;F)
Groups      3 0.002844 0.00094792 1.7709   1000 0.1598
Residuals 100 0.053527 0.00053527                     

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
         ALMR     CRIS     PAST   PUCL
ALMR          0.336663 0.089910 0.8032
CRIS 0.331774          0.345654 0.2168
PAST 0.096959 0.368463          0.0539
PUCL 0.788697 0.208651 0.056996       

#################################################### 
BETA DISPERSION significance test wunifrac distance 
####################################################

Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 1000

Response: Distances
           Df    Sum Sq    Mean Sq      F N.Perm  Pr(&gt;F)  
Groups      3 0.0014351 0.00047837 3.0034   1000 0.03596 *
Residuals 100 0.0159274 0.00015927                        
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Pairwise comparisons:
(Observed p-value below diagonal, permuted p-value above
diagonal)
         ALMR     CRIS     PAST   PUCL
ALMR          0.852148 0.038961 0.1838
CRIS 0.844035          0.049950 0.1668
PAST 0.042375 0.039063          0.1888
PUCL 0.182975 0.146451 0.185432       </code></pre>
</div>
</details>
<p>Remember, if the beta dispersion p-value is greater than <code>0.05</code> we use PERMANOVA, otherwise we use ANOSIM.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">&quot;files/trepo/beta/tables/tmp_merge.txt&quot;</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>          tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_permutest_&quot;</span>, d)))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>          tmp_res <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">isTRUE</span>(tmp_get<span class="sc">$</span>tab<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>[<span class="dv">1</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>          tmp_print <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Permutation test p-value of  &quot;</span>, i, d,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot; &lt; 0.05?&quot;</span>, tmp_res)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">cat</span>(tmp_print,<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">append =</span> <span class="cn">TRUE</span>, <span class="at">file =</span> <span class="st">&quot;files/trepo/beta/tables/tmp_merge.txt&quot;</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>ssu_perm_pvalues <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;files/trepo/beta/tables/tmp_merge.txt&quot;</span>, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">col_names =</span> <span class="st">&quot;permutation results&quot;</span>)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h3 id="significance-tests-all-asvs-1">Significance Tests (ALL ASVs)</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code># A tibble: 3 x 1
  `permutation results`                                               
  &lt;chr&gt;                                                               
1 &quot;Permutation test p-value of   ssu_ps_work jsd  &lt; 0.05? TRUE &quot;      
2 &quot;Permutation test p-value of   ssu_ps_work unifrac  &lt; 0.05? FALSE &quot; 
3 &quot;Permutation test p-value of   ssu_ps_work wunifrac  &lt; 0.05? FALSE &quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_adonis_jsd <span class="ot">&lt;-</span>  <span class="fu">adonis</span>(ssu_ps_work_beta_dist_jsd <span class="sc">~</span> SITE,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> adonis_sampledf, <span class="at">permutations =</span> <span class="dv">1000</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_adonis2_jsd <span class="ot">&lt;-</span> <span class="fu">adonis2</span>(ssu_ps_work_beta_dist_jsd <span class="sc">~</span> SITE,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> adonis_sampledf, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_anosim_unifrac <span class="ot">&lt;-</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_work_prop, <span class="st">&quot;unifrac&quot;</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_work_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_anosim_wunifrac <span class="ot">&lt;-</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_work_prop, <span class="st">&quot;wunifrac&quot;</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_work_groups)</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Significance tests for the ALL ASV data set
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
 ***PERMANOVA for Jensen-Shannon Divergence, `jsd`*** </code></pre>
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 1000

adonis2(formula = ssu_ps_work_beta_dist_jsd ~ SITE, data = adonis_sampledf, permutations = 1000)
          Df SumOfSqs      R2      F   Pr(&gt;F)    
SITE       3   5.3763 0.81399 145.87 0.000999 ***
Residual 100   1.2286 0.18601                    
Total    103   6.6049 1.00000                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre><code>
 ***ANOSIM for Unweighted UniFrac distance, `unifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_work_prop, &quot;unifrac&quot;), grouping = ssu_ps_work_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.8123 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
   90%    95%  97.5%    99% 
0.0235 0.0321 0.0419 0.0543 

Dissimilarity ranks between and within classes:
        0%     25%    50%     75% 100%    N
Between  7 2219.75 3326.5 4342.25 5356 4056
ALMR     5  121.00  636.0 1285.00 3385  325
CRIS    91  804.00 1165.0 1517.00 3533  325
PAST     2  567.00 1095.0 1678.00 3113  325
PUCL     1  383.00  751.0 1422.00 3149  325</code></pre>
<pre><code>
 ***ANOSIM for Weighted-UniFrac distance, `wunifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_work_prop, &quot;wunifrac&quot;),      grouping = ssu_ps_work_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.9244 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
   90%    95%  97.5%    99% 
0.0231 0.0343 0.0456 0.0622 

Dissimilarity ranks between and within classes:
         0%     25%    50%     75% 100%    N
Between 324 2290.75 3328.5 4342.25 5356 4056
ALMR      1  174.00  387.0  844.00 2253  325
CRIS     48  442.00  701.0  977.00 2080  325
PAST      5  415.00  875.0 1646.00 2707  325
PUCL      3  405.00  794.0 1272.00 1988  325</code></pre>
</div>
</details>
<h3 id="significance-tests-pime-asvs-1">Significance Tests (PIME ASVs)</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code># A tibble: 3 x 1
  `permutation results`                                              
  &lt;chr&gt;                                                              
1 &quot;Permutation test p-value of   ssu_ps_pime jsd  &lt; 0.05? TRUE &quot;     
2 &quot;Permutation test p-value of   ssu_ps_pime unifrac  &lt; 0.05? FALSE &quot;
3 &quot;Permutation test p-value of   ssu_ps_pime wunifrac  &lt; 0.05? TRUE &quot;</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_adonis_jsd <span class="ot">&lt;-</span>  <span class="fu">adonis</span>(ssu_ps_pime_beta_dist_jsd <span class="sc">~</span> SITE,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> adonis_sampledf, <span class="at">permutations =</span> <span class="dv">1000</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_adonis2_jsd <span class="ot">&lt;-</span> <span class="fu">adonis2</span>(ssu_ps_pime_beta_dist_jsd <span class="sc">~</span> SITE,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> adonis_sampledf, <span class="at">permutations =</span> <span class="dv">1000</span>)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_anosim_unifrac <span class="ot">&lt;-</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_pime_prop, <span class="st">&quot;unifrac&quot;</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_pime_groups)</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_groups <span class="ot">&lt;-</span> <span class="fu">get_variable</span>(anosim_data, <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_anosim_wunifrac <span class="ot">&lt;-</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anosim</span>(phyloseq<span class="sc">::</span><span class="fu">distance</span>(ssu_ps_pime_prop, <span class="st">&quot;wunifrac&quot;</span>),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grouping =</span> ssu_ps_pime_groups)</span></code></pre></div>
</div>
<details>
<summary>
Detailed results of Significance tests for PIME data set
</summary>
<div class="layout-chunk" data-layout="l-body">
<pre><code>
 ***PERMANOVA for Jensen-Shannon Divergence, `jsd`*** </code></pre>
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 1000

adonis2(formula = ssu_ps_pime_beta_dist_jsd ~ SITE, data = adonis_sampledf, permutations = 1000)
          Df SumOfSqs    R2      F   Pr(&gt;F)    
SITE       3   5.8218 0.807 139.38 0.000999 ***
Residual 100   1.3924 0.193                    
Total    103   7.2141 1.000                    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre><code>
 ***ANOSIM for Unweighted UniFrac distance, `unifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_pime_prop, &quot;unifrac&quot;), grouping = ssu_ps_pime_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.9769 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
   90%    95%  97.5%    99% 
0.0216 0.0324 0.0440 0.0547 

Dissimilarity ranks between and within classes:
         0%     25%    50%     75% 100%    N
Between 888 2314.75 3328.5 4342.25 5356 4056
ALMR     13  205.00  528.0  894.00 1940  325
CRIS     14  468.00  714.0  964.00 1894  325
PAST     22  471.00  879.0 1210.00 2178  325
PUCL      1  264.00  495.0  818.00 1662  325</code></pre>
<pre><code>
 ***ANOSIM for Weighted-UniFrac distance, `wunifrac`*** </code></pre>
<pre><code>
Call:
anosim(x = phyloseq::distance(ssu_ps_pime_prop, &quot;wunifrac&quot;),      grouping = ssu_ps_pime_groups) 
Dissimilarity: 

ANOSIM statistic R: 0.9512 
      Significance: 0.001 

Permutation: free
Number of permutations: 999

Upper quantiles of permutations (null model):
   90%    95%  97.5%    99% 
0.0222 0.0321 0.0419 0.0509 

Dissimilarity ranks between and within classes:
         0%    25%    50%     75% 100%    N
Between 513 2294.5 3328.5 4342.25 5356 4056
ALMR      1  140.0  459.0  879.00 2161  325
CRIS      2  330.0  563.0  810.00 1620  325
PAST     10  366.0  869.0 1606.00 2782  325
PUCL     46  505.0  793.0 1033.00 1764  325</code></pre>
</div>
</details>
<h3 id="summary-1">Summary</h3>
<p>Here is a quick summary of significance tests for the FULL and PIME ASV data sets against the three distance matrices.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">distance metric</th>
<th style="text-align: right;">p-value (MERGE)</th>
<th style="text-align: right;">p-value (PIME)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Jensen-Shannon Divergence</td>
<td style="text-align: right;">0.000999</td>
<td style="text-align: right;">0.000999</td>
</tr>
<tr class="even">
<td style="text-align: left;">unweighted UniFrac</td>
<td style="text-align: right;">0.001000</td>
<td style="text-align: right;">0.001000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weighted UniFrac</td>
<td style="text-align: right;">0.001000</td>
<td style="text-align: right;">0.001000</td>
</tr>
</tbody>
</table>
</div>
<p><em>Summary of significant tests for the ALL ASVs and PIME ASVs data sets.</em></p>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="beta-diversity-plots-1">Beta Diversity Plots</h2>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Here we visualize the different distance matrices using several ordination methods on the ALL and PIME filtered data sets to access dissimilarity among sample.</p>
<h3 id="plots-all-asvs-2">Plots ALL ASVs</h3>
<p>First, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements. We could also test different diversity metrics, different transformations, etc.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_work&quot;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SITE, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SITE))</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_work&quot;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-108"></span>
<img src="include/trepo/beta/ssu_ps_work_merge_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 11: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h3 id="plots-all-pime-asv-1">Plots ALL PIME ASV</h3>
<p>Same as above, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_pime&quot;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(samp_ps, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(samp_ps, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SITE&quot;</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SITE, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SITE))</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="st">&quot;ssu_ps_pime&quot;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-114"></span>
<img src="include/trepo/beta/ssu_ps_pime_merge_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 12: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="beta-diversity-plots-by-site-1">Beta Diversity Plots (by Site)</h2>
<p>Here we visualize the different distance matrices using several ordination methods on the ALL and PIME filtered data sets to access dissimilarity among samples from <strong>the same site</strong>.</p>
<h3 id="plots-all-asvs-3">Plots ALL ASVs</h3>
<p>First, we inspect different ordination methods to see how the samples cluster using <strong>weighted-UniFrac</strong>, <strong>unweighted-UniFrac</strong>, and <strong>Jensen-Shannon Divergence</strong> distance measurements. We could also test different diversity metrics, different transformations, etc.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_merge_ALMR <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_merge_ALMR.rds&quot;</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_merge_CRIS  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_merge_CRIS.rds&quot;</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_merge_PAST <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_merge_PAST.rds&quot;</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>ssu_ps_work_merge_PUCL <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/alpha/rdata/ssu_ps_work_merge_PUCL.rds&quot;</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work_merge_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_PAST&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_PUCL&quot;</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_work_merge_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_PAST&quot;</span>, <span class="st">&quot;ssu_ps_work_merge_PUCL&quot;</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps){</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SEASON&quot;</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SEASON, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SEASON))</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h4 id="almirante-inner-bay-2">Almirante (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-124"></span>
<img src="include/trepo/beta/ssu_ps_work_merge_ALMR_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 13: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="pastores-inner-bay-2">Pastores (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-128"></span>
<img src="include/trepo/beta/ssu_ps_work_merge_PAST_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 14: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="cristobal-outer-bay-2">Cristobal (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-132"></span>
<img src="include/trepo/beta/ssu_ps_work_merge_CRIS_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 15: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="punta-caracol-outer-bay-2">Punta Caracol (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-136"></span>
<img src="include/trepo/beta/ssu_ps_work_merge_PUCL_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 16: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h3 id="plots-pime-asvs-1">Plots PIME ASVs</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_merge_ALMR <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_merge_asv_pime_ALMR.rds&quot;</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_merge_CRIS  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_merge_asv_pime_CRIS.rds&quot;</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_merge_PAST <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_merge_asv_pime_PAST.rds&quot;</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>ssu_ps_pime_merge_PUCL <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;files/trepo/pime/rdata/ssu_ps_merge_asv_pime_PUCL.rds&quot;</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<p>Before we begin, we must first transform sample counts to relative abundance for both data sets.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_pime_merge_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_PAST&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_PUCL&quot;</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps) {</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(tmp_get, <span class="cf">function</span>(otu) otu<span class="sc">/</span><span class="fu">sum</span>(otu))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>     tmp_ps<span class="sc">@</span>phy_tree <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">prune_samples</span>(<span class="fu">sample_sums</span>(tmp_ps) <span class="sc">&gt;</span> <span class="dv">0</span>, tmp_ps)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>     tmp_tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="fu">ntaxa</span>(tmp_ps), <span class="at">rooted =</span> <span class="cn">TRUE</span>, <span class="at">tip.label =</span> <span class="fu">taxa_names</span>(tmp_ps))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>     tmp_ps <span class="ot">&lt;-</span> <span class="fu">merge_phyloseq</span>(tmp_ps, sample_data, tmp_tree)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(tmp_name)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">assign</span>(tmp_name, tmp_ps)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>samp_ps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ssu_ps_pime_merge_ALMR&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_CRIS&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_PAST&quot;</span>, <span class="st">&quot;ssu_ps_pime_merge_PUCL&quot;</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;wunifrac&quot;</span>, <span class="st">&quot;unifrac&quot;</span>, <span class="st">&quot;jsd&quot;</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> samp_ps){</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (d <span class="cf">in</span> dist){</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>     tmp_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, .))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>     tmp_name_plot <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_dist_&quot;</span>, ., <span class="st">&quot;_plot&quot;</span>))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>     tmp_get <span class="ot">&lt;-</span> <span class="fu">get</span>(purrr<span class="sc">::</span><span class="fu">map_chr</span>(i, <span class="sc">~</span> <span class="fu">paste0</span>(., <span class="st">&quot;_prop&quot;</span>)))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>     ord_meths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NMDS&quot;</span>, <span class="st">&quot;PCoA&quot;</span>, <span class="st">&quot;CCA&quot;</span>, <span class="st">&quot;DCA&quot;</span>) <span class="co">#    MDS = PCoA, &quot;CCA&quot;, &quot;DCA&quot;, &quot;DPCoA&quot;, &quot;RDA&quot;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>     tmp_plist_name <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(d, <span class="sc">~</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_&quot;</span>, ., <span class="st">&quot;_plist&quot;</span>))</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>     tmp_plist <span class="ot">&lt;-</span> <span class="fu">llply</span>(<span class="fu">as.list</span>(ord_meths), <span class="cf">function</span>(i, physeq, d) {</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>        ordi <span class="ot">=</span> <span class="fu">ordinate</span>(physeq, <span class="at">method =</span> i, <span class="at">distance =</span> d)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot_ordination</span>(physeq, ordi, <span class="st">&quot;samples&quot;</span>, <span class="at">color =</span> <span class="st">&quot;SEASON&quot;</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>   }, tmp_get, d)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_plist) <span class="ot">&lt;-</span> ord_meths</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  tmp_df <span class="ot">&lt;-</span> <span class="fu">ldply</span>(tmp_plist, <span class="cf">function</span>(x){</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">=</span> x<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Axis_1&quot;</span>, <span class="st">&quot;Axis_2&quot;</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(df, x<span class="sc">$</span>data))})</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(tmp_df)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">&quot;method&quot;</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  tmp_df<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_df<span class="sc">$</span>SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tmp_df, <span class="fu">aes</span>(Axis_1, Axis_2,</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> SEASON, <span class="at">shape =</span> SEASON, <span class="at">fill =</span> SEASON))</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_plist_name, tmp_plist)</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name, tmp_df)</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tmp_name_plot, tmp_plot)</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>(<span class="at">pattern =</span> <span class="st">&quot;_dist_&quot;</span>)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="fu">objects</span>()</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>plist_name <span class="ot">&lt;-</span> <span class="fu">objects</span>(<span class="at">pattern=</span><span class="st">&quot;_plist&quot;</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>plot_num <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> plist_name) {</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> plot_num) {</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>       tmp_get_i <span class="ot">&lt;-</span> <span class="fu">get</span>(i)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>     <span class="do">## NEXT  LINE REORDER FACTORS</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>       tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp_get_i[[j]]<span class="sc">$</span>data<span class="sc">$</span>SITE, </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;ALMR&quot;</span>, <span class="st">&quot;PAST&quot;</span>, <span class="st">&quot;CRIS&quot;</span>, <span class="st">&quot;PUCL&quot;</span>))</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>       tmp_ord <span class="ot">&lt;-</span> <span class="fu">names</span>(tmp_get_i)[j]</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>       tmp_name <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(i, <span class="st">&quot;plist&quot;</span>, tmp_ord)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_get_i[[j]] <span class="sc">+</span> <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> swel_col)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>       tmp_plot <span class="ot">&lt;-</span> tmp_plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SEASON)) <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>       tmp_plot<span class="sc">$</span>labels<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="st">&quot;SEASON&quot;</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">assign</span>(tmp_name, tmp_plot)</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;tmp_&quot;</span>))</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h4 id="almirante-inner-bay-3">Almirante (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-145"></span>
<img src="include/trepo/beta/ssu_ps_pime_merge_ALMR_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 17: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="pastores-inner-bay-3">Pastores (inner bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-149"></span>
<img src="include/trepo/beta/ssu_ps_pime_merge_PAST_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 18: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="cristobal-outer-bay-3">Cristobal (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-153"></span>
<img src="include/trepo/beta/ssu_ps_pime_merge_CRIS_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 19: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h4 id="punta-caracol-outer-bay-3">Punta Caracol (outer bay)</h4>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="figure"><span id="fig:unnamed-chunk-157"></span>
<img src="include/trepo/beta/ssu_ps_pime_merge_PUCL_beta_div_ord_plots.png" alt="**Left** = Jensen-Shannon Divergence, **middle** = UniFrac (unwieghted), **right** = UniFrac (wieghted); **Top** = NMDS, **bottom** = PCoA." width="4252" />
<p class="caption">
Figure 20: <strong>Left</strong> = Jensen-Shannon Divergence, <strong>middle</strong> = UniFrac (unwieghted), <strong>right</strong> = UniFrac (wieghted); <strong>Top</strong> = NMDS, <strong>bottom</strong> = PCoA.
</p>
</div>
</div>
<h2 class="appendix" id="source-code">Source Code</h2>
<p>The source code for this page can be accessed on GitHub by <a href="https://github.com/tropical-repo/web/blob/master/trepo-beta.Rmd">clicking this link</a>. Please note, that in order to process the data <em>and</em> build the website, we needed to run the workflow and get the results. Then hard code the results and turn off the individual commands. So the raw file for this page is a bit messy—you have been warned.</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
<h3 id="updates-and-corrections">Corrections</h3>
<p>If you see mistakes or want to suggest changes, please <a href="https://github.com/tropical-repo/web/issues/new">create an issue</a> on the source repository.</p>
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Source code is available at <a href="https://github.com/tropical-repo/web/">https://github.com/tropical-repo/web/</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<p>© Copyright 2021 The TROPICAL-REPO Project.</p>
<p>Site constructed using <a href="https://rstudio.github.io/distill/">Distill for R Markdown</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
